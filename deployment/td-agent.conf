<source>
  @type forward
  bind 0.0.0.0
  port 24224
</source>

<match **>
   # plugin type
   @type kinesis_streams

   # your kinesis stream name
   stream_name CHANGEME

   # AWS credentials.
   # Can be defined here or in an Environment Variables
   # env vars: AWS_ACCESS_KEY_ID
   #           AWS_SECRET_ACCESS_KEY

   #aws_key_id CHANGEME
   #aws_sec_key CHANGEME

   # AWS region
   region CHANGEME

   <buffer>

     queue_limit_length "#{ENV['BUFFER_QUEUE_LIMIT'] || '32' }"
     chunk_limit_size "#{ENV['BUFFER_SIZE_LIMIT'] || '1m' }"
     flush_interval "#{ENV['FORWARD_FLUSH_INTERVAL'] || '60s'}"
     flush_at_shutdown "#{ENV['FLUSH_AT_SHUTDOWN'] || 'false'}"
     flush_thread_count "#{ENV['FLUSH_THREAD_COUNT'] || 2}"
     retry_max_interval "#{ENV['FORWARD_RETRY_WAIT'] || '300'}"

     flush_thread_interval 0.1
     flush_thread_burst_interval 0.01

     # Parallelism of ingestion
     flush_thread_count 15

     retry_forever true

     overflow_action "#{ENV['BUFFER_QUEUE_FULL_ACTION'] || 'exception'}"
   </buffer>
</match>
